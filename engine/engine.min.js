function ParticleSpawner(e,n){this.floor=.07+n,this.x=e,this.y=n,this.particles=[],this.update=function(){for(var e=0;e<this.particles.length;e++){var n=this.particles[e];n.update()}},this.render=function(){for(var e=0;e<this.particles.length;e++){var n=this.particles[e];n.render()}},this.spawnParticle=function(e,n){this.particles.push(new Particle(this.x,this.y,e,n,this))}}function Particle(e,n,i,t,s){this.x=e,this.y=n,this.xv=i,this.yv=t,this.gravity=!0,this.time=1,this.render=function(){engine.context.save(),engine.context.globalAlpha=this.time,engine.drawImage(engine.images[0],159,44,9,8,this.x*engine.width,this.y*engine.height,25,25),engine.context.restore()},this.update=function(){this.time-=.02,this.time<=0&&s.particles.splice(s.particles.indexOf(this),1),this.gravity&&(this.yv+=5e-4),this.y+this.yv>=s.floor&&(this.y=s.floor,this.yv=0,this.xv>0?this.xv-=2e-4:this.xv+=2e-4,Math.abs(this.xv)<=5e-4&&(this.xv=0)),this.x+=this.xv,this.y+=this.yv}}function resize(){engine.width=$(window).width(),engine.height=$(window).height(),engine.scene.style.top=0,engine.width>MAX_WIDTH?(engine.width=MAX_WIDTH,engine.scene.style.left=$(window).width()/2-MAX_WIDTH/2):engine.scene.style.left=0,engine.height>MAX_HEIGHT?(engine.height=MAX_HEIGHT,engine.scene.style.top=$(window).height()/2-MAX_HEIGHT/1.6,null!=engine.desc&&(engine.desc.style.top=$(window).height()/2+MAX_HEIGHT/2.4),showDesc=!0):showDesc=!1,showDesc?null!=engine.desc&&(engine.desc.style.display="block"):null!=engine.desc&&(engine.desc.style.display="none"),engine.scene.width=engine.width,engine.scene.height=engine.height,engine.context=engine.scene.getContext("2d"),engine.context.ImageSmoothingEnabled=engine.context.imageSmoothingEnabled=engine.context.mozImageSmoothingEnabled=engine.context.oImageSmoothingEnabled=!1}function Sprite(e,n,i,t,s,g){this.name=e,this.x=n,this.y=i,this.width=t,this.height=s,this.image=g}function Animation(e,n,i,t,s,g,o){this.name=e,this.image=n.image,this.spriteWidth=i,this.spriteHeight=t,this.fps=s,this.play=!1,this.loop=g,this.currentFrame=0,this.framesWide=this.image.width/this.spriteWidth,this.framesHigh=this.image.height/this.spriteHeight,this.numFrames=void 0!=o&&null!=o&&0!=o?o:this.framesWide*this.framesHigh,this.timer=0,this.play=function(){this.play=!0},this.stop=function(){this.play=!1},this.update=function(){this.timer++,this.timer>=60/this.fps&&(this.currentFrame++,this.currentFrame>=this.numFrames&&(this.currentFrame=0),this.timer=0)},this.draw=function(e,n,i,t){var s=this.spriteWidth*Math.round(this.currentFrame%this.framesWide),g=this.spriteHeight*Math.floor(this.currentFrame/this.framesHigh);engine.drawImage(this.image,s,g,this.spriteWidth,this.spriteHeight,e,n,i,t)}}function ImageObject(e,n){this.name=e,this.image=n}function initImages(){var e=engine.imagePaths;requiredImages=e.length;for(i in e){var n=new Image;n.src=e[i][1],engine.images[i]=new ImageObject(e[i][0],n),engine.images[i].image.onload=function(){doneImages++}}}function checkImages(){doneImages>=requiredImages?engine.init():setTimeout(function(){checkImages()},1)}var engine={};engine.mx=0,engine.my=0,engine.mb=!1,engine.keys=[];var WIDTH=800,HEIGHT=600,MAX_WIDTH=1920,MAX_HEIGHT=1080;engine.width=$(window).width(),engine.height=$(window).height();var showDesc=!0;engine.scene=null,engine.loadScene=function(e){function n(e,n){var i=e.getBoundingClientRect();return{x:n.clientX-i.left,y:n.clientY-i.top}}console.log("Loaded scene: "+e),engine.scene=document.getElementById(e),engine.scene.style.position="absolute",resize();engine.scene.getBoundingClientRect();engine.scene.addEventListener("mousemove",function(e){var i=n(engine.scene,e);engine.mx=i.x,engine.my=i.y},!1),engine.scene.onmousedown=function(){engine.mb=!0},engine.scene.onmouseup=function(){engine.mb=!1},engine.scene.onmouseleave=function(){engine.mb=!1}},engine.loadDescription=function(){engine.desc=document.getElementById("desc"),null!=engine.desc&&(engine.desc.style.position="relative",engine.desc.style.textAlign="center")},engine.drawImage=function(e,n,i,t,s,g,o,a,h){engine.context.drawImage(e,n,i,t,s,g-a/2,o-h/2,a,h)},window.onresize=function(){resize()},$(document).keydown(function(e){engine.keys[e.keyCode?e.keyCode:e.whitch]=!0}),$(document).keyup(function(e){delete engine.keys[e.keyCode?e.keyCode:e.whitch]}),engine.init=function(){console.log("Init"),engine.loop()},engine.start=function(){initImages(),checkImages(),resize()},engine.loop=function(){requestAnimFrame(function(){engine.loop()}),engine.render()},engine.render=function(){},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),engine.drawSprite=function(e,n,i,t,s){var g;g=e instanceof Sprite?e:engine.getSprite(e),engine.drawImage(g.image.image,g.x,g.y,g.width,g.height,n,i,t,s)},engine.sprites=[],engine.addSprite=function(e){engine.sprites.push(e)},engine.getSprite=function(e){for(var n=0;n<engine.sprites.length;n++)if(null!=engine.sprites[n]&&engine.sprites[n].name==e)return engine.sprites[n];return null},engine.animations=[],engine.addAnimation=function(e){engine.animations.push(e)},engine.getAnimation=function(e){for(var n=0;n<engine.animations.length;n++)if(null!=engine.animations[n]&&engine.animations[n].name==e)return engine.animations[n];return null},engine.updateAnimations=function(){for(var e=0;e<engine.animations.length&&!(e>=engine.animations.length);e++){var n=engine.animations[e];null!=n&&n.update()}},engine.images=[],engine.imagePaths=[],engine.loadImage=function(e,n){engine.imagePaths.push([e,n])},engine.getImage=function(e){for(var n=0;n<engine.images.length;n++)if(engine.images[n].name==e)return engine.images[n];return null};var doneImages=0,requiredImages=0;